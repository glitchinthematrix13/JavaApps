<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Pattern Engine | Animated</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: #33ff33; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        canvas { filter: drop-shadow(0 0 15px rgba(51, 255, 51, 0.3)); transition: opacity 0.5s; }
        .control-panel { background: rgba(0, 20, 0, 0.9); border-right: 1px solid #1a331a; }
        input[type=range] { accent-color: #33ff33; background: #001a00; }
        .btn-active { background-color: #33ff33 !important; color: #000 !important; }
    </style>
</head>
<body class="flex flex-col md:flex-row h-screen">

    <div class="control-panel w-full md:w-80 p-6 flex flex-col gap-6 overflow-y-auto z-10">
        <header>
            <h1 class="text-xl font-bold tracking-widest uppercase text-green-400">Geometry_V2.0</h1>
            <p class="text-green-900 text-[10px] mt-1 italic">PARAMETRIC OSCILLATION SYSTEM</p>
        </header>

        <div class="space-y-5">
            <div>
                <label class="block text-[10px] font-bold text-green-700 mb-2 uppercase tracking-tighter">Outer Radius (R)</label>
                <input type="range" id="paramR" min="50" max="300" value="150">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-green-700 mb-2 uppercase tracking-tighter">Inner Radius (r)</label>
                <input type="range" id="paramr" min="1" max="200" value="52">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-green-700 mb-2 uppercase tracking-tighter">Pen Offset (d)</label>
                <input type="range" id="paramd" min="10" max="300" value="120">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-green-700 mb-2 uppercase tracking-tighter">Detail / Density</label>
                <input type="range" id="density" min="10" max="300" value="120">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-green-700 mb-2 uppercase tracking-tighter">Color Phase</label>
                <input type="range" id="hue" min="0" max="360" value="140">
            </div>
        </div>

        <div class="mt-auto space-y-3 pt-6 border-t border-green-900">
            <button id="animBtn" onclick="toggleAnimation()" class="w-full border border-green-500 py-2 text-xs font-bold hover:bg-green-500 hover:text-black transition uppercase tracking-widest">
                Start_Auto_Pilot
            </button>
            <button onclick="downloadPattern()" class="w-full bg-green-900/20 border border-green-900 text-green-700 py-2 text-xs font-bold hover:text-green-400 transition uppercase">
                Capture_Frame
            </button>
        </div>
    </div>

    <div class="flex-1 relative flex items-center justify-center p-4 bg-black">
        <canvas id="patternCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('patternCanvas');
        const ctx = canvas.getContext('2d');
        const inputs = ['paramR', 'paramr', 'paramd', 'density', 'hue'];
        
        let isAnimating = false;
        let time = 0;

        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            if (!isAnimating) draw();
        }

        function toggleAnimation() {
            isAnimating = !isAnimating;
            const btn = document.getElementById('animBtn');
            btn.innerText = isAnimating ? "Stop_Auto_Pilot" : "Start_Auto_Pilot";
            btn.classList.toggle('btn-active');
            if (isAnimating) animate();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            let R = parseFloat(document.getElementById('paramR').value);
            let r = parseFloat(document.getElementById('paramr').value);
            let d = parseFloat(document.getElementById('paramd').value);
            const dens = parseFloat(document.getElementById('density').value);
            const hue = parseFloat(document.getElementById('hue').value);

            if (isAnimating) {
                // Use sine waves to fluctuate values slightly for organic movement
                r = r + Math.sin(time * 0.5) * 20;
                d = d + Math.cos(time * 0.3) * 30;
            }

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            ctx.beginPath();
            ctx.strokeStyle = `hsl(${hue}, 80%, 50%)`;
            ctx.lineWidth = 1;
            ctx.globalAlpha = 0.8;

            for (let t = 0; t < Math.PI * dens; t += 0.1) {
                // Hypotrochoid Equation
                const x = (R - r) * Math.cos(t) + d * Math.cos(((R - r) * t) / r);
                const y = (R - r) * Math.sin(t) - d * Math.sin(((R - r) * t) / r);

                if (t === 0) ctx.moveTo(centerX + x, centerY + y);
                else ctx.lineTo(centerX + x, centerY + y);
            }
            ctx.stroke();
        }

        function animate() {
            if (!isAnimating) return;
            time += 0.02;
            draw();
            requestAnimationFrame(animate);
        }

        function downloadPattern() {
            const link = document.createElement('a');
            link.download = `sim-pattern-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        window.addEventListener('resize', resize);
        inputs.forEach(id => document.getElementById(id).addEventListener('input', draw));
        
        resize();
    </script>
</body>
</html>